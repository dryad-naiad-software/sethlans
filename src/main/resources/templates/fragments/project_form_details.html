<!DOCTYPE html>
<!--
  ~ Copyright (c) 2018 Dryad and Naiad Software LLC.
  ~
  ~ This program is free software; you can redistribute it and/or
  ~ modify it under the terms of the GNU General Public License
  ~ as published by the Free Software Foundation; either version 2
  ~ of the License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program; if not, write to the Free Software
  ~ Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  ~
  -->

<!--suppress XmlDuplicatedId -->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">


<!-- Project Form Fragment -->
<div th:fragment="project_form_details">

    <div class="container" style="max-width: 600px;">
        <!--/*@thymesVar id="projectForm" type="com.dryadandnaiad.sethlans.commands.ProjectForm"*/-->
        <form class="form-horizontal" id="projectWizard" name="projectWizard" th:action="@{/project/new/details}"
              th:object="${projectForm}"
              method="POST">
            <br/>
            <h2 class="text-center" id="projectFormTitle">Project Details</h2>
            <div th:if="${#fields.hasErrors('*') and projectForm.getPrevious() == T(com.dryadandnaiad.sethlans.enums.ProjectFormProgress).DETAILS}"
                 class="alert alert-danger">
                <div align="center" th:text="#{form.hasErrors}">Error Message</div>
            </div>
            <div class="form-group"
                 th:if="${projectForm.getPrevious() == T(com.dryadandnaiad.sethlans.enums.ProjectFormProgress).DETAILS}"
                 th:class="${#fields.hasErrors('projectName')} ? 'form-group has-error' : 'form-group'">
                <label class="control-label" for="projectName">Project Name</label>
                <input type="text" name="projectName" id="projectName" th:value="${projectForm.projectName}"
                       class="form-control">
                <span class="help-block">
                    <ul>
                        <li th:each="err : ${#fields.errors('projectName')}"
                                            th:text="${err}"/>
                    </ul>
                </span>
            </div>
            <div class="form-group"
                 th:unless="${projectForm.getPrevious() == T(com.dryadandnaiad.sethlans.enums.ProjectFormProgress).DETAILS}">
                <label class="control-label" for="projectName">Project Name</label>
                <input type="text" name="projectName" id="projectName" th:value="${projectForm.projectName}"
                       class="form-control">
            </div>
            <div class="form-group">
                <label for="selectedBlenderVersion">Available Blender Versions</label>
                <select class="form-control" id="selectedBlenderVersion" name="selectedBlenderVersion"
                        th:value="${projectForm.selectedBlenderVersion}">
                    <option th:each="blenderVersion : ${projectForm.getAvailableBlenderVersions()}"
                            th:value="${blenderVersion}"
                            th:text="${blenderVersion}">Version
                    </option>
                    <option th:remove="all">2.78c</option>
                </select>
            </div>
            <div class="form-group" id="outputFormatGroup" style="display: none">
                <label for="outputFormat">Output Format</label>
                <select class="form-control" id="outputFormat" name="outputFormat"
                        th:value="${projectForm.outputFormat}">
                    <!--/*@thymesVar id="formats" type="com.dryadandnaiad.sethlans.enums.RenderOutputFormat"*/-->
                    <option th:each="format : ${formats}"
                            th:value="${format}" th:text="${format}">PNG
                    </option>
                    <option th:remove="all">AVI</option>
                </select>
            </div>

            <div class="form-group">
                <label class="control-label">Project Type</label><br/>
                <label class="control-label"><input type="radio" name="projectType"
                                                    th:field="${projectForm.projectType}"
                                                    th:value="${T(com.dryadandnaiad.sethlans.enums.ProjectType).STILL_IMAGE}"
                                                    value="STILL_IMAGE">&emsp;
                    Still
                    Image</label><br/>
                <label class="control-label" for="framenum">Frame Number</label>
                <input type="number" id="framenum" name="startFrame" th:field="${projectForm.startFrame}"
                       class="form-control">

            </div>


            <div class="form-group"
                 th:if="${projectForm.getPrevious() == T(com.dryadandnaiad.sethlans.enums.ProjectFormProgress).DETAILS}"
                 th:class="${#fields.hasErrors('stepFrame')} ? 'form-group has-error' : 'form-group'">
                <label class="control-label"><input type="radio" name="projectType"
                                                    th:field="${projectForm.projectType}"
                                                    th:value="${T(com.dryadandnaiad.sethlans.enums.ProjectType).ANIMATION}"
                                                    value="ANIMATION">&emsp;
                    Animation</label><br/>
                <label class="control-label" for="startframe">Start Frame</label>
                <input type="number" id="startframe" th:field="${projectForm.startFrame}" class="form-control" disabled>
                <label class="control-label" for="endframe">End Frame</label>
                <input type="number" id="endframe" th:field="${projectForm.endFrame}" class="form-control" disabled>
                <label class="control-label" for="framestep">Frame Step</label>
                <input type="number" id="framestep" th:field="${projectForm.stepFrame}" class="form-control" disabled>
                <span class="help-block">
                    <ul>
                        <li th:each="err : ${#fields.errors('stepFrame')}"
                            th:text="${err}"/>
                    </ul>
                </span>
            </div>
            <div class="form-group"
                 th:unless="${projectForm.getPrevious() == T(com.dryadandnaiad.sethlans.enums.ProjectFormProgress).DETAILS}">
                <label class="control-label"><input type="radio" name="projectType"
                                                    th:field="${projectForm.projectType}"
                                                    th:value="${T(com.dryadandnaiad.sethlans.enums.ProjectType).ANIMATION}"
                                                    value="ANIMATION">&emsp;
                    Animation</label><br/>
                <label class="control-label" for="startframe">Start Frame</label>
                <input type="number" id="startframe" th:field="${projectForm.startFrame}" class="form-control" disabled>
                <label class="control-label" for="endframe">End Frame</label>
                <input type="number" id="endframe" th:field="${projectForm.endFrame}" class="form-control" disabled>
                <label class="control-label" for="framestep">Frame Step</label>
                <input type="number" id="framestep" th:field="${projectForm.stepFrame}" class="form-control" disabled>
                <span class="help-block">
                </span>
            </div>


            <div class="form-group" id="renderOnGroup" style="display: block">
                <label for="renderOn">Render On:</label>
                <select class="form-control" id="renderOn" name="renderOn"
                        th:value="${projectForm.renderOn}">
                    <!--/*@thymesVar id="compute_types" type="com.dryadandnaiad.sethlans.enums.ComputeType"*/-->
                    <option th:each="method : ${compute_types}"
                            th:value="${method}" th:text="${method.getName()}"
                            th:selected="${projectForm.renderOn.equals(method)}">CPU
                    </option>
                    <option th:remove="all">GPU</option>
                    <option th:remove="all">CPU &amp; GPU</option>
                </select>
            </div>

            <div class="form-group">
                <label for="blenderEngine">Rendering Engine:</label>
                <select class="form-control" id="blenderEngine" name="blenderEngine"
                        th:value="${projectForm.blenderEngine}" onchange="selectEngine()">
                    <!--These errors can be ignored, thymeleaf doesn't recognize values from enum though it is valid. -->
                    <!--/*@thymesVar id="engines" type="java.util.List"*/-->
                    <option th:each="engine : ${engines}"
                            th:value="${engine}" th:text="${engine.getName()}"
                            th:selected="${projectForm.blenderEngine.equals(engine)}">Cycles
                    </option>
                    <!--End of comment-->
                    <option th:remove="all">Engine1</option>
                    <option th:remove="all">Engine2</option>
                </select>
                <div id="sampleGroup" style="display: block">
                    <label class="control-label" for="samples">Samples</label>
                    <input type="number" id="samples" class="form-control" name="samples"
                           th:field="${projectForm.samples}">
                </div>
            </div>

            <div class="form-group">

                <label>Resolution:
                    <div class="form-inline">
                        <input type="number" th:field="${projectForm.resolutionX}" class="form-control form-inline">
                        <input type="number" th:field="${projectForm.resolutionY}" class="form-control form-inline">
                    </div>
                </label>

            </div>
            <div class="form-group">
                <style>.slider-selection {
                    background: #0C8DCE;
                }</style>
                <label for="scaling">Final Image Scaling: &emsp; &emsp; </label>
                <input id="scaling" th:field="${projectForm.resPercentage}" type="number"
                       data-slider-min="1"
                       data-slider-max="100"
                       th:attr="data-slider-value=${projectForm.getResPercentage()}"
                       data-slider-step="1"/>
            </div>
            <div class="form-group">
                <style>.slider-selection {
                    background: #0C8DCE;
                }</style>
                <label for="renderParts">Number of Rendering Parts per Frame: &emsp; &emsp; </label>
                <input id="renderParts" th:field="${projectForm.partsPerFrame}" type="number"
                       data-slider-min="2"
                       data-slider-max="16"
                       th:attr="data-slider-value=${projectForm.getPartsPerFrame()}"
                       data-slider-step="2"/>
            </div>


            <div class="form-group">
                <input type="hidden" th:field="${projectForm.id}"/>
                <input type="hidden" th:field="${projectForm.version}"/>
                <input type="hidden" th:field="${projectForm.started}"/>
                <input type="hidden" th:field="${projectForm.finished}"/>
                <input type="hidden" name="uploadedFile" th:value="${projectForm.uploadedFile}">
                <input type="hidden" name="fileLocation" th:value="${projectForm.fileLocation}">
                <input type="hidden" name="uuid" th:value="${projectForm.uuid}">
                <input type="hidden" id="progress" name="progress" value="FINISHED">
                <input type="hidden" id="previous" name="previous" value="DETAILS">
                <a href="/project" class="btn btn-default">Cancel</a>
                <button type="submit" class="btn btn-primary pull-right" id="projectSubmit">Submit Project</button>
            </div>
        </form>
        <script defer="defer" th:inline="javascript">
            window.onload = function () {
                readRadio();
                $("#tiles").slider({tooltip_position: 'bottom'});
                $("#scaling").slider({tooltip_position: 'top'});
                $("#renderParts").slider({tooltip_position: 'bottom'});
                $('input[type="radio"]').on('change', function () {
                    readRadio();
                });
                selectEngine();
            };

            function readRadio() {
                var typeValue = document.querySelector('input[name="projectType"]:checked').value;
                if (typeValue === "STILL_IMAGE") {
                    document.getElementById("framenum").disabled = false;
                    document.getElementById("startframe").disabled = true;
                    document.getElementById("endframe").disabled = true;
                    document.getElementById("framestep").disabled = true;
                    document.getElementById("outputFormatGroup").style.display = "none";
                    document.getElementById("outputFormat").value = "PNG";
                }
                if (typeValue === "ANIMATION") {
                    document.getElementById("framenum").disabled = true;
                    document.getElementById("startframe").disabled = false;
                    document.getElementById("endframe").disabled = false;
                    document.getElementById("framestep").disabled = false;
                    document.getElementById("outputFormatGroup").style.display = "block";
                }
            }

            function selectEngine() {
                var method = document.getElementById("blenderEngine");
                var text = method.options[method.selectedIndex].text;
                if (text.indexOf('Cycles') >= 0) {
                    document.getElementById("sampleGroup").style.display = "block";
                    document.getElementById("renderOnGroup").style.display = "block";
                    document.getElementById("samples").disabled = false;
                } else {
                    document.getElementById("sampleGroup").style.display = "none";
                    document.getElementById("renderOnGroup").style.display = "none";
                    document.getElementById("samples").disabled = true;
                    document.getElementById("renderOn").value = "CPU";
                }

            }

        </script>
    </div>
</div>

</html>